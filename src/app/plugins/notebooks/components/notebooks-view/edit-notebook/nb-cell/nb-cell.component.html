<div class="nb-cell" #cellDiv (click)="onFocus($event)" (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()"
     tabindex="-1">
    <div *ngIf="isFocused" class="nb-overlay">
        <div class="nb-overlay-buttons btn-group btn-group-sm mr-2" role="group" aria-label="Overlay Buttons">
            <select class="form-select btn bg-light px-0" aria-label="Select Cell Type"
                    (change)="changeType.emit($event)"
                    [value]="selectedCellType">
                <option value="code">Code</option>
                <option value="markdown">Markdown</option>
                <option value="poly">Polypheny</option>
                <option value="raw">Raw</option>
            </select>
            <div class="nb-overlay-separator bg-secondary"></div>
            <button type="button" class="btn btn-light vertical-icons py-0 no-select-cell" (click)="insert.emit(false)"
                    onclick="this.blur();" tooltip="insert cell above (A)" container="body">
                <i class="fa fa-chevron-up no-select-cell"></i>
                <i class="fa fa-plus-square vertical-icon-plus-bottom no-select-cell"></i>
            </button>
            <button type="button" class="btn btn-light vertical-icons py-0 no-select-cell" (click)="insert.emit(true)"
                    onclick="this.blur();" tooltip="insert cell below (B)" container="body">
                <i class="fa fa-plus-square vertical-icon-plus-top no-select-cell"></i>
                <i class="fa fa-chevron-down no-select-cell"></i>
            </button>
            <div class="nb-overlay-separator bg-secondary"></div>
            <button class="btn btn-light no-select-cell" (click)="deleteCell()" (mouseleave)="resetDeleteConfirm()"
                    tooltip="delete cell" container="body">
                <i class="no-select-cell"
                   [ngClass]="{'cui-trash': !confirmingDeletion, 'fa fa-warning': confirmingDeletion}"></i>
            </button>
        </div>
    </div>

    <div class="nb-input-wrapper text-monospace">
        <div class="nb-select-bar" [ngClass]=
                "{'bg-primary': isFocused, 'bg-white': !isFocused && !isMouseOver, 'bg-light': isMouseOver && !isFocused}"></div>
        <div class="nb-side-area">
            <span *ngIf="cell.cell_type === 'code'"
                  [ngClass]="{'text-primary': isFocused, 'text-secondary': !isFocused}">
                [{{(isExecuting ? '*' : cell.execution_count) || ' '}}]:
            </span>
            <button *ngIf="(isFocused || isMouseOver)&& (cell.cell_type === 'code' || (cell.cell_type === 'markdown' && !isMdRendered))"
                    type="button" class="btn nb-exec-btn"
                    (click)="executeCell()" onclick="this.blur();">
                <i class="fa fa-play"></i>
            </button>

            <ng-content></ng-content> <!-- turns the drag-container into a DragHandle-->
        </div>
        <markdown class="nb-markdown" *ngIf="cell.cell_type === 'markdown' && isMdRendered"
                  katex [katexOptions]="options"
                  [data]="mdSource"
                  (ready)="onReady()"
                  (dblclick)="editMode()">
        </markdown>
        <div [hidden]="isMdRendered" class="sql-console form-group border" (click)="editMode()" [ngClass]=
                "{'border-primary': isFocused && (mode==='edit'),'border-light': !isFocused || (mode==='command')}">
            <app-nb-input-editor #editor [type]="cell.cell_type" (focusin)="onEditorFocus()" (focusout)="onEditorBlur()"
                                 id="nb-editor"></app-nb-input-editor>
        </div>
    </div>


    <div class="nb-output-wrapper text-monospace" *ngIf="cell.cell_type === 'code'">
        <div class="nb-select-bar" [ngClass]=
                "{'bg-primary': isFocused, 'bg-white': !isFocused && !isMouseOver, 'bg-light': isMouseOver && !isFocused}"></div>
        <div class="nb-outputs">
            <div class="nb-output" *ngFor="let output of cell.outputs">
                <ng-container *ngIf="output.output_type !== 'execute_result'; else elseExecuteResult">
                    <div class="nb-side-area"></div>

                    <div class="nb-output-text">
                        <ng-container [ngSwitch]="output.output_type">
                            <ng-container *ngSwitchCase="'stream'">
                                <span class="nb-plaintext">{{ output.text}}</span>
                            </ng-container>
                            <ng-container *ngSwitchCase="'display_data'">
                                <app-nb-output-data [data]="output.data"></app-nb-output-data>
                            </ng-container>
                            <pre class="nb-error text-monospace" *ngSwitchCase="'error'"
                                 [innerHTML]="errorHtml">
                            </pre>
                        </ng-container>

                    </div>
                </ng-container>

                <ng-template #elseExecuteResult>
                    <div class="nb-side-area">
                        <span [ngClass]="{'text-primary': isFocused, 'text-secondary': !isFocused}">
                            [{{(isExecuting ? '*' : cell.execution_count) || ' '}}]:
                        </span>
                    </div>

                    <div class="nb-output-text nb-execute-result">
                        <app-nb-output-data [data]="output.data"></app-nb-output-data>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>

