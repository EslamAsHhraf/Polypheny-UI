<h1>Notebooks Dashboard</h1>
<br>

<div class="row">
    <div class="col-lg-4 fixed-width">
        <div class="card">
            <div class="card-header">
                <span class="mb-0">Jupyter Server</span>
            </div>
            <div class="card-body">
                <h5>{{serverStatus ? 'Online' : 'Offline'}} </h5>
                <ng-container *ngIf="serverStatus">
                    <p>Started: {{serverStatus.started | date: 'short'}}</p>
                    <p>Last Activity: {{serverStatus.last_activity | date: 'short'}}</p>
                </ng-container>
            </div>

            <div class="card-footer bg-transparent">
                <button class="btn btn-danger pull-right"
                        (click)="serverStatus ? restartContainerModal.show() : restartContainer()">
                    {{serverStatus ? 'Restart Container' : 'Start Container'}}
                </button>
            </div>
        </div>
    </div>
    <div class="col-lg-6 fixed-width" *ngIf="serverStatus">
        <div class="card">
            <div class="card-header">
                <span class="mb-0">Kernels</span>
            </div>
            <div class="card-body">
                <h5 *ngIf="sessions.length === 0; else hasRunningKernels">No Kernel Running</h5>
                <ng-template #hasRunningKernels>
                    <h5>Running Kernels ({{sessions.length}})</h5>

                    <table class="table table-hover table-striped">

                        <thead>
                        <tr>
                            <th>Notebook</th>
                            <th>Kernel</th>
                            <th>Last Activity</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let session of sessions; index as i"
                            [ngClass]="{'preferred-session': isPreferredSession[i]}">
                            <td>{{notebookPaths[i]}}</td>
                            <td>{{session.kernel.name}}</td>
                            <td>{{session.kernel.last_activity | date: 'short'}}</td>
                            <td>{{session.kernel.execution_state}}</td>
                            <th></th>
                        </tr>
                        </tbody>

                    </table>
                </ng-template>


            </div>

            <div class="card-footer bg-transparent">
                <button class="btn btn-danger pull-right" [disabled]="sessions.length === 0"
                        (click)="terminateSessionsModal.show()">
                    Shut Down All
                </button>
            </div>
        </div>
    </div>
</div>

<div bsModal #terminateSessionsModal="bs-modal" class="modal" tabindex="-1" role="dialog"
     aria-labelledby="terminateSessionsModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Shut Down All Kernels</h4>
                <button type="button" class="close" (click)="terminateSessionsModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>Are you sure you want to shut down all running Kernels? Unsaved changes might be lost.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="terminateSessionsModal.hide()">Cancel</button>
                <button type="button" class="btn btn-danger" (click)="terminateSessions()"
                        [disabled]="deleting">
                    <span *ngIf="!deleting">Shut Down All</span>
                    <span *ngIf="deleting" class="spinner-border spinner-border-sm" role="status"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<div bsModal #restartContainerModal="bs-modal" class="modal" tabindex="-1" role="dialog"
     aria-labelledby="terminateSessionsModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Restart Docker Container</h4>
                <button type="button" class="close" (click)="restartContainerModal.hide()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>Are you sure you want to restart the Jupyter Server Docker Container? This will shut down all running
                    Kernels. Unsaved changes might be lost.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="restartContainerModal.hide()">Cancel</button>
                <button type="button" class="btn btn-danger" (click)="restartContainer()">
                    <span>Restart</span>
                </button>
            </div>
        </div>
    </div>
</div>
