<div class="text-danger mb-3"
     *ngIf="result() && result().error && !result().header">{{result().error}}</div>

<c-row *ngIf="result() && result().header">
    <c-col [lg]="12" id="data-table-wrapper" [ngClass]="{ 'overflow-y-hidden': entityConfig().exploring }">
        <table cTable hover bordered small
               [striped]="!entityConfig().exploring || exploreSet"
               [ngClass]="{'loading': loading()}" id="data-table"
               [attr.data-table]="result().entityName">
            <thead>
            <tr>
                <ng-container *ngIf="result()?.namespaceType !== NamespaceType.DOCUMENT">
                    <ng-container *ngFor="let h of result().header">
                        <th>
                        <span [tooltip]="getTooltip(h)" placement="bottom" [delay]="200" container="body"
                              [ngClass]="{'pk': h.primary}">{{ h.name }}</span>
                            <a *ngIf="false && entityConfig().sort && canOrder(h) && h.name !== '_data'" [routerLink]="[]"
                               [ngClass]="{'btn-primary' : h.sort.sorting, 'btn-light': !h.sort.sorting, 'btn btn-sm float-right': true}"
                               (click)="sortTable(h.sort)">
                                <i [ngClass]="h.sort.direction === 'ASC' ? 'icon-arrow-up' : 'icon-arrow-down'"></i>
                            </a>
                        </th>
                    </ng-container>
                </ng-container>
                <th class="delete" *ngIf="entityConfig().delete">
                    <!--<i class="cui-trash"></i>-->
                </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngIf="entityConfig().search">
                <td *ngFor="let h of result().header">
                    <input *ngIf="_types.isNumeric(h.dataType) && !h.collectionsType" type="number"
                           class="form-control form-control-sm table-filter" placeholder="search"
                           [id]="'search-' + h.name" [attr.data-col]="h.name" [value]="h.filter"
                           (keyup)="filterTable($event, filter1.value, h)" #filter1>
                    <input *ngIf="( ! _types.isNumeric(h.dataType) && !_types.isMultimedia(h.dataType) && !_types.isDocument(result().namespaceType) && !_types.isGraph(result().namespaceType)) || h.collectionsType"
                           type="text" class="form-control form-control-sm table-filter" placeholder="search"
                           [attr.data-col]="h.name" [id]="'search-' + h.name" [value]="h.filter"
                           (keyup)="filterTable($event, filter2.value, h)" #filter2
                           [ngClass]="isValidFilter(filter2.value,h)">
                </td>
                <td *ngIf="entityConfig().update || entityConfig().delete"></td>
            </tr>
            <tr *ngFor="let d1 of result().data; let i = index"
                [ngClass]="{'editing': editing === i, 'table-success' : this.userInput[d1] === 'true', 'table' : this.userInput === null, 'table-danger': this.userInput[d1] === 'false', 'table': this.userInput[d1] === '?'}">
                <ng-container *ngIf="editing === i">
                    <td *ngFor="let d2 of d1; let j = index">
                        <app-input class="editing" [header]="result().header[j]"
                                   [value]="updateValues.get(result().header[j].name)"
                                   (valueChange)="newUpdateValue(result().header[j].name, $event)"
                                   (enter)="updateTuple()" [attr.data-before]="d2"
                                   [attr.data-col]="result().header[j].name"></app-input>
                    </td>
                    <td *ngIf="entityConfig.update || entityConfig().delete">
                        <button cButton color="primary" *ngIf="uploadProgress === -1" id="editColSave"
                                (click)="updateTuple()"><i class="fa fa-save"></i></button>
                        <progressbar *ngIf="uploadProgress > -1 && uploadProgress !== 100 && uploadProgress !== 0"
                                     [animate]="true" [value]="uploadProgress === 0 ? 100 : uploadProgress"
                                     [striped]="false" type="primary" class="file-progress"></progressbar>
                        <progressbar *ngIf="uploadProgress > -1 && (uploadProgress === 100 || uploadProgress === 0)"
                                     [animate]="true" [value]="100" [striped]="true" type="primary"
                                     class="file-progress"></progressbar>
                    </td>
                </ng-container>
                <!-- table which shows results  -->
                <ng-container *ngIf="editing !== i">
                    <td *ngFor="let d2 of d1; let j = index" (dblclick)="triggerEditing(i)">
                        <ng-container [ngSwitch]="removeNull(result().header[j].dataType)" *ngIf="d2">
                            <ng-container *ngSwitchCase="'FILE'">
                                <a *ngIf="downloadingIthRow !== i" [routerLink]="[]" class="download"
                                   (click)="getFile(d2, i)" download><span class="cil-cloud-download"></span></a>
                                <progressbar
                                        *ngIf="downloadingIthRow === i && downloadProgress > -1 && downloadProgress !== 0 && downloadProgress !== 100"
                                        [animate]="true" [value]="downloadProgress === 0 ? 100 : downloadProgress"
                                        type="primary" class="file-progress"></progressbar>
                                <progressbar
                                        *ngIf="downloadingIthRow === i && downloadProgress > -1 && (downloadProgress === 100 || downloadProgress === 0)"
                                        [animate]="true" [value]="downloadProgress === 0 ? 100 : downloadProgress"
                                        [striped]="true" type="primary" class="file-progress"></progressbar>
                            </ng-container>
                            <img *ngSwitchCase="'IMAGE'" [src]="getFileLink(d2)"
                                 style="max-height:200px; max-width: 300px"/>
                            <app-media *ngSwitchCase="'VIDEO'" [src]="getFileLink(d2)"
                                       [type]="result().header[j].dataType"
                                       [style]="{width: '300px'}"></app-media>
                            <app-media *ngSwitchCase="'AUDIO'" [src]="getFileLink(d2)"
                                       [type]="result().header[j].dataType"
                                       [style]="{width: '300px'}"></app-media>
                            <app-json-text
                                    *ngSwitchCase="['JSON','DOCUMENT', 'NODE', 'EDGE', 'PATH', 'GRAPH', 'DocumentType'] | multipleSwitch: removeNull(result().header[j].dataType)"
                                    [text]="d2"></app-json-text>
                            <app-json-text *ngSwitchCase="'ANY'" [text]="d2"></app-json-text>
                            <app-expandable-text *ngSwitchDefault [text]="d2"></app-expandable-text>
                        </ng-container>
                    </td>
                    <!--<td *ngIf="config.exploring && asExploreResult(null).classificationInfo == 'ClassificationPossible'"> // todo dl inject via plugin
                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-secondary" [ngClass]="{'active' : userInput[d1] === 'true'}">
                                <input type="radio" class="form-control" name="choose" value="true" id="true"
                                       autocomplete="off"
                                       (click)="this.userInput[d1] = 'true'"> true
                            </label>
                            <label class="btn btn-secondary active"
                                   [ngClass]="{'active' : userInput[d1] === '?' || userInput[d1] === undefined }">
                                <input type="radio" class="form-control" name="choose" value="?" id="ignored"
                                       autocomplete="off" checked
                                       (click)="this.userInput[d1] = '?'"> N/A
                            </label>
                            <label class="btn btn-secondary" [ngClass]="{'active' : userInput[d1] === 'false'}">
                                <input type="radio" class="form-control" name="choose" value="false" id="false"
                                       autocomplete="off"
                                       (click)="this.userInput[d1] = 'false'; exploreData()"> false
                            </label>
                        </div>
                    </td>-->
                    <td class="delete" *ngIf="entityConfig().update || entityConfig().delete">
                        <button cButton color="danger" cTextColor="white" *ngIf="entityConfig().delete" [ngClass]="{ 'cil-trash': i !== confirm, 'cil-warning': i === confirm }"
                           (click)="deleteRow(d1, i)" (mouseleave)="confirm = -1"></button>
                    </td>
                </ng-container>
            </tr>
            <tr *ngIf="!result().data || result().data.length === 0">
                <td *ngIf="!result().error" [attr.colspan]="result().header.length+1"
                    class="text-danger text-center">(no data to show)
                </td>
                <td *ngIf="result().error" [attr.colspan]="result().header.length+1"
                    class="text-danger text-center">error while filtering entity
                </td>
            </tr>
            <tr *ngIf="entityConfig().create" id="insertRow">
                <td *ngFor="let h of result().header">
                    <app-input [header]="h" [value]="insertValues.get(h.name)"
                               (valueChange)="inputChange(h.name, $event)"
                               (enter)="insertTuple()"></app-input>
                </td>
                <td *ngIf="entityConfig.update || entityConfig().delete">
                    <button cButton color="primary" id="addColumnBtn" (click)="insertTuple()"
                            *ngIf="uploadProgress === -1 || editing !== -1">+
                    </button>
                    <progressbar
                            *ngIf="editing === -1 && uploadProgress > -1 && uploadProgress !== 0 && uploadProgress !== 100"
                            [animate]="true" [value]="uploadProgress === 0 ? 100 : uploadProgress" [striped]="false"
                            type="primary" class="file-progress"></progressbar>
                    <progressbar
                            *ngIf="editing === -1 && uploadProgress > -1 && (uploadProgress === 100 || uploadProgress === 0)"
                            [animate]="true" [value]="100" [striped]="true" type="primary"
                            class="file-progress"></progressbar>
                    <!--<progressbar *ngIf="editing === -1 && uploadProgress > -1" [animate]="true" [value]="uploadProgress === 0 ? 100 : uploadProgress" [striped]="uploadProgress === 100 || uploadProgress === 0" type="primary" class="file-progress"></progressbar>-->
                </td>
            </tr>
            </tbody>
        </table>
    </c-col>
</c-row>

<c-row class="row" *ngIf="result()">
    <c-col class="col-lg-12">
        <nav aria-label="Page navigation" class="float-right" *ngIf="result().highestPage > 1">
            <c-pagination>
                <li *ngFor="let p of pagination" class="page-item" cPageItem
                    [ngClass]="{ 'disabled': p.disabled, 'active': p.active }">
                    <a cPageItem (click)="paginate(p)" [routerLink]="[]">{{p.label}}</a>
                </li>
            </c-pagination>
        </nav>
        <!--<button cButton color="primary" id="resetClassification" type="button"
                *ngIf="entityConfig.exploring && asExploreResult(null).classificationInfo == 'ClassificationPossible' "
                (click)="resetExplorationData()">Reset
        </button>
        <button cButton color="primary" id="startClassification" type="button"
                *ngIf="config.exploring && asExploreResult(null).classificationInfo == 'ClassificationPossible' && ((this.initalClassifiation && this.getSelected() > 7 ) || (!this.initalClassifiation))"
                (click)="startClassification()">Start Classification
        </button>
        <button cButton color="primary" id="showDecisionTree" type="button"
                *ngIf="config.exploring && this.exploreSet !== undefined && config.exploring && result().data"
                (click)="openDecisionTree(decisionTree)">Show Decision Tree
        </button>
        <button cButton color="primary" id="showSQL" type="button"
                *ngIf="config.exploring && this.exploreSet !== undefined && config.exploring && this.finalresult && asExploreResult(null).isConvertedToSql"
                (click)="openSQL(sql)">Show SQL Statement
        </button>
        <button cButton color="primary" id="sendClassification" type="button"
                *ngIf="config.exploring && asExploreResult(null).classificationInfo == 'ClassificationPossible' && this.exploreSet !== undefined "
                (click)="sendChosenCols()">Execute
        </button>

        <button id="createView" cButton color="primary" type="button" tooltip="create view"
                *ngIf="config.exploring && this.exploreSet !== undefined && config.exploring && this.finalresult && asExploreResult(null).isConvertedToSql"
                (click)="createViewButton(createViewExample)"> Create View
        </button>-->
    </c-col>
</c-row>


<ng-template #decisionTree>
    <c-modal-content>
        <c-modal-header class="modal-header">
            <h4 cModalTitle class="pull-left">Decision Tree</h4>
            <button cButtonClose class="close pull-right" aria-label="Close" (click)="modalRefDecision.hide()"></button>
        </c-modal-header>
        <c-modal-body id="modal-body-tree">
            The decision tree shows how the data has been classified.
        </c-modal-body>
    </c-modal-content>
</ng-template>

<ng-template #sql>
    <c-modal-content>
        <c-modal-header >
            <h4 cModalTitle class="pull-left">SQL Statement</h4>
            <button cButtonClose type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()"></button>
        </c-modal-header>
        <c-modal-body id="modal-body-SQL">
            <div id="example-wrapper" style="height: 150px">
                <app-editor #editorGenerated [code]="createdSQL"></app-editor>
            </div>
        </c-modal-body>
    </c-modal-content>
</ng-template>

<ng-template #tutorial>
    <c-modal-content>
        <c-modal-header class="modal-header">
            <h4 cModalTitle class="pull-left">Check Classification</h4>
            <button cButtonClose type="button" class="close pull-right" aria-label="Close" (click)="modalRefTutorial.hide()"></button>
        </c-modal-header>
        <c-modal-body id="modal-body-tutorial">
            Now a classifier has been created, if it is not as wished it can be changed by changing "true" and "false".
            Otherwise the final dataset can be created with "Execute".
        </c-modal-body>
    </c-modal-content>
</ng-template>


<div class="hidden-layer">
    <div class="scaling-svg-container">
        <svg id="tree" xmlns="http://www.w3.org/2000/svg" class="scaling-svg" viewBox="auto">
            <g/>
        </svg>
    </div>
</div>


